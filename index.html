
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aesthetic Analysis: Manual Annotation</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { margin-bottom: 10px; font-size: 1.5rem; }
        p { color: #64748b; margin-bottom: 20px; max-width: 600px; text-align: center; }

        /* Upload Section */
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Workspace: Image + Canvas Overlay */
        .workspace {
            position: relative;
            display: inline-block;
            border: 2px dashed var(--border);
            background: #eee;
            min-width: 300px;
            min-height: 200px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        img {
            display: block;
            max-width: 100%;
            height: auto;
            pointer-events: none; /* Let clicks pass through to canvas */
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
        }

        /* Report Grid */
        .reports-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        /* Individual Report Card */
        .report-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            animation: fadeIn 0.3s ease-in;
            border-left: 5px solid var(--primary);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .tier-badge {
            background: #eff6ff;
            color: #1d4ed8;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <h1>Client-Side Aesthetic Annotation</h1>
    <p>Upload an image. Click on faces to generate a procedural aesthetic report based on coordinate hashing. No data is sent to any server.</p>

    <div class="controls">
        <input type="file" id="imageInput" accept="image/png, image/jpeg">
        <button onclick="resetApp()" style="margin-left: 10px; padding: 5px 10px; cursor: pointer;">Clear All</button>
    </div>

    <div class="workspace" id="workspace">
        <div id="placeholder" style="padding: 50px; text-align: center; color: #999;">Image Preview Area</div>
    </div>

    <div class="reports-container" id="reports">
        </div>

    <script>
        const workspace = document.getElementById('workspace');
        const fileInput = document.getElementById('imageInput');
        const reportsDiv = document.getElementById('reports');
        let canvas, ctx;
        let faceCount = 0;

        // --- DATASETS (Deterministic Selection) ---
        const tiers = ["LTN (Low Tier Normal)", "MTN (Mid Tier Normal)", "HTN (High Tier Normal)", "Chadlite", "Chad", "Model Tier"];
        const harmonies = ["Average", "Good", "High", "Exceptional", "Unbalanced"];
        const features = [
            "Strong jawline projection detected.",
            "Neutral canthal tilt observed.",
            "High facial leanness indicated.",
            "Mid-face ratio is compact.",
            "Upper third dominance.",
            "Soft features with high harmony."
        ];

        // --- CORE LOGIC ---

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                setupWorkspace(event.target.result);
            };
            reader.readAsDataURL(file);
        });

        function setupWorkspace(imgSrc) {
            workspace.innerHTML = ''; // Clear placeholder
            faceCount = 0;
            reportsDiv.innerHTML = '';

            const img = new Image();
            img.src = imgSrc;
            img.onload = function() {
                // Resize constraint for viewability
                if (img.width > 800) {
                    img.style.width = "100%";
                }
                
                workspace.appendChild(img);

                // Create Overlay Canvas
                canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                // Match visual size if CSS resized image
                canvas.style.width = "100%";
                canvas.style.height = "100%";
                
                workspace.appendChild(canvas);
                ctx = canvas.getContext('2d');

                // Add Click Listener
                canvas.addEventListener('click', handleCanvasClick);
            }
        }

        function handleCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            
            // Calculate scale in case image is resized by CSS
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const x = (event.clientX - rect.left) * scaleX;
            const y = (event.clientY - rect.top) * scaleY;

            faceCount++;
            drawSelection(x, y);
            generateReport(x, y, faceCount);
        }

        function drawSelection(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, 40, 0, 2 * Math.PI); // Draw 40px radius circle
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#2563eb'; // Primary Blue
            ctx.stroke();
            
            // Add Label
            ctx.fillStyle = '#2563eb';
            ctx.font = "bold 20px Arial";
            ctx.fillText(`#${faceCount}`, x + 45, y);
        }

        // --- THE "HONEST" ALGORITHM (Deterministic Hashing) ---
        // This generates a report based on WHERE you click. 
        // It is not random (same click = same result), but it isn't AI either.
        function generateReport(x, y, id) {
            // Simple hash function based on coordinates
            const seed = Math.floor(x * y + x + y); 

            const tier = tiers[seed % tiers.length];
            const harmony = harmonies[seed % harmonies.length];
            // Use a secondary math op to get a different index for feature
            const feature = features[(seed * 3) % features.length]; 
            
            const potential = (60 + (seed % 40)) + "%"; // Between 60% and 99%

            const html = `
                <div class="report-card">
                    <div class="report-header">
                        <span>FACE #${id} ANALYSIS</span>
                        <span>ID: ${seed.toString(16).toUpperCase()}</span>
                    </div>
                    <div class="stat-row">
                        <span>Classification:</span>
                        <span class="tier-badge">${tier}</span>
                    </div>
                    <div class="stat-row">
                        <span>Facial Harmony:</span>
                        <span>${harmony}</span>
                    </div>
                    <div class="stat-row">
                        <span>Max Potential:</span>
                        <span>${potential}</span>
                    </div>
                    <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
                    <div style="font-size: 0.85rem; color: #555;">
                        <strong>Key Observation:</strong><br>
                        ${feature}
                    </div>
                </div>
            `;

            reportsDiv.insertAdjacentHTML('beforeend', html);
        }

        function resetApp() {
            fileInput.value = '';
            workspace.innerHTML = '<div id="placeholder" style="padding: 50px; text-align: center; color: #999;">Image Preview Area</div>';
            reportsDiv.innerHTML = '';
        }
    </script>
</body>
</html>
